1. 目标（Goal）

在现有 nosocomium-online 多模块 Spring Boot 项目中，实现一套 统一、可扩展、可控暴露的异常与错误响应机制，用于所有 HTTP 接口。

核心目标：

所有 HTTP 非 2xx 错误 → 使用 自定义异常体系

异常 → HTTP Code + 默认中文错误消息

生产 / 测试 / 开发环境统一拦截

对外不泄露系统细节

2. 设计约束（Constraints）
   语言: Java 17
   框架: Spring Boot 3.x
   架构: DDD 分层

强制规则

❌ 不允许在 Controller 中手写 try-catch

❌ 不允许直接抛 RuntimeException 给前端

✅ 业务异常必须是自定义异常

✅ HTTP 状态码由异常本身决定

✅ 异常结构可扩展，不影响现有代码

3. 异常体系设计（Exception System）
   3.1 基础标记接口（必须）

位置：

src/core.shared/src/main/java
└── com/mayanshe/nosocomiumonline/shared/exception


创建接口：

public interface INosocomiumException {
}


规则：

该接口 只作为标记接口

不定义任何方法

所有自定义 HTTP 异常 必须实现该接口

3.2 HTTP 异常基类（必须）

在同一 package 下创建抽象基类：

public abstract class AbstractHttpException
extends RuntimeException
implements INosocomiumException {

    private final int httpStatus;
    private final String defaultMessage;
}


强制要求：

每个异常 必须绑定一个 HTTP Status Code

每个异常 必须有默认中文错误消息

默认消息用于：

prod / release / test / dev 环境

未显式指定 message 的场景

3.3 HTTP Code → 异常一一对应（强制）

规则：

除了 2xx 之外，每一个 HTTP Code 必须有一个对应的异常类

示例（必须生成）：

400 → BadRequestException
401 → UnauthorizedException
403 → ForbiddenException
404 → NotFoundException
409 → ConflictException
422 → UnprocessableEntityException
500 → InternalServerErrorException


每个异常：

放在 core.shared 的 exception 包下

命名必须体现 HTTP 语义

必须：

设定固定 httpStatus

设定默认中文错误消息

示例默认消息（示意）：

400: 请求参数错误
401: 未授权访问
403: 无权限访问
404: 资源不存在
409: 资源冲突
422: 请求无法处理
500: 系统内部错误

4. 异常存放位置（强制）
   src/core.shared
   └── src/main/java
   └── com/mayanshe/nosocomiumonline/shared/exception
   ├── INosocomiumException.java
   ├── AbstractHttpException.java
   ├── BadRequestException.java
   ├── UnauthorizedException.java
   ├── ForbiddenException.java
   ├── NotFoundException.java
   ├── ConflictException.java
   ├── UnprocessableEntityException.java
   └── InternalServerErrorException.java

5. 全局异常处理器（GlobalExceptionHandler）
   5.1 创建位置（强制）

模块：

src/core.infrastructure


路径：

src/core.infrastructure/src/main/java
└── com/mayanshe/nosocomiumonline/infrastructure/config

5.2 类定义（必须）
@ControllerAdvice
@Profile({"prod", "release", "test", "dev"})
public class GlobalExceptionHandler {
}

6. 异常处理规则（核心逻辑）
   6.1 处理 INosocomiumException（必须）

规则：

捕获所有 INosocomiumException

响应：

HTTP Status：异常中定义的 httpStatus

返回消息：异常中的 message（或默认中文消息）

不返回堆栈

不返回内部错误信息

输出示例（结构示意）：

{
"code": 404,
"message": "资源不存在"
}

6.2 处理其它异常（必须）

规则：

捕获所有 Exception / Throwable

HTTP Status：500

返回统一消息：

"请求失败，请重试"


示例：

{
"code": 500,
"message": "请求失败，请重试"
}

7. 严格禁止项（Hard Rules）

❌ 不允许将异常类放在 api 模块

❌ 不允许在 core.domain / core.application 处理 HTTP 语义

❌ 不允许把异常 message 直接暴露为 e.getMessage()（除 INosocomiumException）

❌ 不允许在 prod / release 输出 stack trace

8. 验证要求（Antigravity 必须满足）

Antigravity 执行完成后，必须满足：

任意 API 模块抛出 NotFoundException

HTTP Status = 404

中文消息正确返回

抛出 NullPointerException

HTTP Status = 500

返回 "请求失败，请重试"

项目整体：

mvn clean package


编译通过

9. 设计意图（供 AI 理解）

core.shared.exception：稳定契约层

INosocomiumException：异常语义边界

GlobalExceptionHandler：唯一 HTTP 错误出口

防止：

错误信息污染

业务异常与技术异常混杂

Controller 层 try-catch 蔓延

10. 备注
请全程用中文和我交流

备注应注尽注

性能优先，其次优雅

